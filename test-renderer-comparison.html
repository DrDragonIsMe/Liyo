<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MarkdownRenderer vs MathRenderer 对比测试</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .test-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        .test-section {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            background: #f9f9f9;
        }
        .test-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
            border-bottom: 2px solid #007acc;
            padding-bottom: 5px;
        }
        .test-content {
            background: white;
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #eee;
            min-height: 200px;
        }
        .raw-content {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            white-space: pre-wrap;
            margin-bottom: 15px;
            border: 1px solid #ddd;
        }
        .status {
            margin-top: 10px;
            padding: 8px;
            border-radius: 4px;
            font-size: 14px;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .warning { background: #fff3cd; color: #856404; }
    </style>
    <!-- React 和相关依赖 -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- KaTeX -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.js"></script>
    
    <!-- React Markdown 和相关插件 -->
    <script src="https://unpkg.com/react-markdown@8.0.7/react-markdown.min.js"></script>
    <script src="https://unpkg.com/remark-gfm@3.0.1/index.js"></script>
</head>
<body>
    <h1>🔬 MarkdownRenderer vs MathRenderer 渲染对比测试</h1>
    <p>此页面用于对比两个组件的渲染效果，找出MarkdownRenderer不生效的原因。</p>
    
    <div id="test-app"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;
        
        // 测试内容
        const testContent1 = `配方法是将二次方程 $ax^2 + bx + c = 0$ 转化为 $(x + m)^2 = n$ 的形式的解法。

## 基本步骤

1. **移项**：将常数项移到等号右边
   $ax^2 + bx = -c$

2. **系数化1**：两边同时除以 $a$
   $x^2 + \\frac{b}{a}x = -\\frac{c}{a}$

3. **配方**：两边同时加上一次项系数一半的平方
   $$x^2 + \\frac{b}{a}x + \\left(\\frac{b}{2a}\\right)^2 = -\\frac{c}{a} + \\left(\\frac{b}{2a}\\right)^2$$

## 关键公式

配方后的标准形式：
$$\\left(x + \\frac{b}{2a}\\right)^2 = \\frac{\\Delta}{4a^2}$$

其中判别式 $\\Delta = b^2 - 4ac$`;
        
        const testContent2 = "这是一个简单的行内公式 $x^2 + y^2 = z^2$ 和块级公式：$$\\int_0^1 x^2 dx = \\frac{1}{3}$$";
        
        // 模拟 MathRenderer 组件
        const MathRenderer = ({ content }) => {
            const [renderedContent, setRenderedContent] = useState('');
            const [error, setError] = useState(null);
            
            useEffect(() => {
                try {
                    // 简单的数学公式渲染逻辑
                    let processed = content;
                    
                    // 渲染块级公式
                    processed = processed.replace(/\$\$([^$]+)\$\$/g, (match, formula) => {
                        try {
                            return `<div class="katex-display">${katex.renderToString(formula.trim(), { displayMode: true })}</div>`;
                        } catch (e) {
                            return `<span class="error">$$${formula}$$</span>`;
                        }
                    });
                    
                    // 渲染行内公式
                    processed = processed.replace(/\$([^$]+)\$/g, (match, formula) => {
                        try {
                            return katex.renderToString(formula.trim(), { displayMode: false });
                        } catch (e) {
                            return `<span class="error">$${formula}$</span>`;
                        }
                    });
                    
                    // 处理换行
                    processed = processed.replace(/\n/g, '<br/>');
                    
                    setRenderedContent(processed);
                    setError(null);
                } catch (e) {
                    setError(e.message);
                }
            }, [content]);
            
            if (error) {
                return <div className="error">MathRenderer 错误: {error}</div>;
            }
            
            return <div dangerouslySetInnerHTML={{ __html: renderedContent }} />;
        };
        
        // 模拟 MarkdownRenderer 组件（简化版）
        const MarkdownRenderer = ({ content }) => {
            const [renderedContent, setRenderedContent] = useState('');
            const [error, setError] = useState(null);
            
            useEffect(() => {
                try {
                    // 检查是否有数学公式
                    const hasMath = /\$.*?\$/.test(content);
                    
                    if (!hasMath) {
                        // 没有数学公式，直接用markdown渲染
                        setRenderedContent(`<div>纯Markdown内容（无数学公式）: ${content}</div>`);
                        return;
                    }
                    
                    // 有数学公式的处理逻辑
                    let processed = content;
                    
                    // 先处理块级公式
                    const blockMatches = [];
                    processed = processed.replace(/\$\$([^$]+)\$\$/g, (match, formula, offset) => {
                        blockMatches.push({ start: offset, end: offset + match.length, formula: formula.trim() });
                        return `__BLOCK_MATH_${blockMatches.length - 1}__`;
                    });
                    
                    // 再处理行内公式
                    const inlineMatches = [];
                    processed = processed.replace(/\$([^$]+)\$/g, (match, formula, offset) => {
                        inlineMatches.push({ start: offset, end: offset + match.length, formula: formula.trim() });
                        return `__INLINE_MATH_${inlineMatches.length - 1}__`;
                    });
                    
                    // 渲染数学公式
                    blockMatches.forEach((match, index) => {
                        try {
                            const rendered = katex.renderToString(match.formula, { displayMode: true });
                            processed = processed.replace(`__BLOCK_MATH_${index}__`, `<div class="katex-display">${rendered}</div>`);
                        } catch (e) {
                            processed = processed.replace(`__BLOCK_MATH_${index}__`, `<span class="error">$$${match.formula}$$</span>`);
                        }
                    });
                    
                    inlineMatches.forEach((match, index) => {
                        try {
                            const rendered = katex.renderToString(match.formula, { displayMode: false });
                            processed = processed.replace(`__INLINE_MATH_${index}__`, rendered);
                        } catch (e) {
                            processed = processed.replace(`__INLINE_MATH_${index}__`, `<span class="error">$${match.formula}$</span>`);
                        }
                    });
                    
                    // 处理markdown语法（简化）
                    processed = processed
                        .replace(/^## (.+)$/gm, '<h2>$1</h2>')
                        .replace(/^# (.+)$/gm, '<h1>$1</h1>')
                        .replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>')
                        .replace(/^\d+\. (.+)$/gm, '<li>$1</li>')
                        .replace(/\n/g, '<br/>');
                    
                    setRenderedContent(processed);
                    setError(null);
                } catch (e) {
                    setError(e.message);
                }
            }, [content]);
            
            if (error) {
                return <div className="error">MarkdownRenderer 错误: {error}</div>;
            }
            
            return <div dangerouslySetInnerHTML={{ __html: renderedContent }} />;
        };
        
        const TestApp = () => {
            const [selectedTest, setSelectedTest] = useState(1);
            
            const currentContent = selectedTest === 1 ? testContent1 : testContent2;
            
            return (
                <div>
                    <div style={{ marginBottom: '20px' }}>
                        <button 
                            onClick={() => setSelectedTest(1)}
                            style={{ 
                                marginRight: '10px', 
                                padding: '8px 16px',
                                backgroundColor: selectedTest === 1 ? '#007acc' : '#f0f0f0',
                                color: selectedTest === 1 ? 'white' : 'black',
                                border: 'none',
                                borderRadius: '4px',
                                cursor: 'pointer'
                            }}
                        >
                            测试1: 复杂内容
                        </button>
                        <button 
                            onClick={() => setSelectedTest(2)}
                            style={{ 
                                padding: '8px 16px',
                                backgroundColor: selectedTest === 2 ? '#007acc' : '#f0f0f0',
                                color: selectedTest === 2 ? 'white' : 'black',
                                border: 'none',
                                borderRadius: '4px',
                                cursor: 'pointer'
                            }}
                        >
                            测试2: 简单内容
                        </button>
                    </div>
                    
                    <div className="raw-content">
                        <strong>原始内容:</strong><br/>
                        {currentContent}
                    </div>
                    
                    <div className="test-container">
                        <div className="test-section">
                            <div className="test-title">📝 MarkdownRenderer 渲染结果</div>
                            <div className="test-content">
                                <MarkdownRenderer content={currentContent} />
                            </div>
                            <div className="status success">✅ MarkdownRenderer 组件已加载</div>
                        </div>
                        
                        <div className="test-section">
                            <div className="test-title">🧮 MathRenderer 渲染结果</div>
                            <div className="test-content">
                                <MathRenderer content={currentContent} />
                            </div>
                            <div className="status success">✅ MathRenderer 组件已加载</div>
                        </div>
                    </div>
                    
                    <div className="test-section">
                        <div className="test-title">🔍 渲染分析</div>
                        <div className="test-content">
                            <p><strong>预期行为:</strong></p>
                            <ul>
                                <li>MarkdownRenderer 应该同时渲染 Markdown 语法和数学公式</li>
                                <li>MathRenderer 应该只渲染数学公式，保留其他文本</li>
                                <li>两者的数学公式渲染效果应该相同</li>
                            </ul>
                            
                            <p><strong>检查要点:</strong></p>
                            <ul>
                                <li>数学公式是否正确渲染为 KaTeX 格式</li>
                                <li>Markdown 语法（标题、粗体、列表）是否正确转换</li>
                                <li>是否有 JavaScript 错误（检查浏览器控制台）</li>
                            </ul>
                        </div>
                    </div>
                </div>
            );
        };
        
        ReactDOM.render(<TestApp />, document.getElementById('test-app'));
    </script>
</body>
</html>