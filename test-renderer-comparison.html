<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MarkdownRenderer vs MathRenderer å¯¹æ¯”æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .test-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        .test-section {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            background: #f9f9f9;
        }
        .test-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
            border-bottom: 2px solid #007acc;
            padding-bottom: 5px;
        }
        .test-content {
            background: white;
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #eee;
            min-height: 200px;
        }
        .raw-content {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            white-space: pre-wrap;
            margin-bottom: 15px;
            border: 1px solid #ddd;
        }
        .status {
            margin-top: 10px;
            padding: 8px;
            border-radius: 4px;
            font-size: 14px;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .warning { background: #fff3cd; color: #856404; }
    </style>
    <!-- React å’Œç›¸å…³ä¾èµ– -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- KaTeX -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.js"></script>
    
    <!-- React Markdown å’Œç›¸å…³æ’ä»¶ -->
    <script src="https://unpkg.com/react-markdown@8.0.7/react-markdown.min.js"></script>
    <script src="https://unpkg.com/remark-gfm@3.0.1/index.js"></script>
</head>
<body>
    <h1>ğŸ”¬ MarkdownRenderer vs MathRenderer æ¸²æŸ“å¯¹æ¯”æµ‹è¯•</h1>
    <p>æ­¤é¡µé¢ç”¨äºå¯¹æ¯”ä¸¤ä¸ªç»„ä»¶çš„æ¸²æŸ“æ•ˆæœï¼Œæ‰¾å‡ºMarkdownRendererä¸ç”Ÿæ•ˆçš„åŸå› ã€‚</p>
    
    <div id="test-app"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;
        
        // æµ‹è¯•å†…å®¹
        const testContent1 = `é…æ–¹æ³•æ˜¯å°†äºŒæ¬¡æ–¹ç¨‹ $ax^2 + bx + c = 0$ è½¬åŒ–ä¸º $(x + m)^2 = n$ çš„å½¢å¼çš„è§£æ³•ã€‚

## åŸºæœ¬æ­¥éª¤

1. **ç§»é¡¹**ï¼šå°†å¸¸æ•°é¡¹ç§»åˆ°ç­‰å·å³è¾¹
   $ax^2 + bx = -c$

2. **ç³»æ•°åŒ–1**ï¼šä¸¤è¾¹åŒæ—¶é™¤ä»¥ $a$
   $x^2 + \\frac{b}{a}x = -\\frac{c}{a}$

3. **é…æ–¹**ï¼šä¸¤è¾¹åŒæ—¶åŠ ä¸Šä¸€æ¬¡é¡¹ç³»æ•°ä¸€åŠçš„å¹³æ–¹
   $$x^2 + \\frac{b}{a}x + \\left(\\frac{b}{2a}\\right)^2 = -\\frac{c}{a} + \\left(\\frac{b}{2a}\\right)^2$$

## å…³é”®å…¬å¼

é…æ–¹åçš„æ ‡å‡†å½¢å¼ï¼š
$$\\left(x + \\frac{b}{2a}\\right)^2 = \\frac{\\Delta}{4a^2}$$

å…¶ä¸­åˆ¤åˆ«å¼ $\\Delta = b^2 - 4ac$`;
        
        const testContent2 = "è¿™æ˜¯ä¸€ä¸ªç®€å•çš„è¡Œå†…å…¬å¼ $x^2 + y^2 = z^2$ å’Œå—çº§å…¬å¼ï¼š$$\\int_0^1 x^2 dx = \\frac{1}{3}$$";
        
        // æ¨¡æ‹Ÿ MathRenderer ç»„ä»¶
        const MathRenderer = ({ content }) => {
            const [renderedContent, setRenderedContent] = useState('');
            const [error, setError] = useState(null);
            
            useEffect(() => {
                try {
                    // ç®€å•çš„æ•°å­¦å…¬å¼æ¸²æŸ“é€»è¾‘
                    let processed = content;
                    
                    // æ¸²æŸ“å—çº§å…¬å¼
                    processed = processed.replace(/\$\$([^$]+)\$\$/g, (match, formula) => {
                        try {
                            return `<div class="katex-display">${katex.renderToString(formula.trim(), { displayMode: true })}</div>`;
                        } catch (e) {
                            return `<span class="error">$$${formula}$$</span>`;
                        }
                    });
                    
                    // æ¸²æŸ“è¡Œå†…å…¬å¼
                    processed = processed.replace(/\$([^$]+)\$/g, (match, formula) => {
                        try {
                            return katex.renderToString(formula.trim(), { displayMode: false });
                        } catch (e) {
                            return `<span class="error">$${formula}$</span>`;
                        }
                    });
                    
                    // å¤„ç†æ¢è¡Œ
                    processed = processed.replace(/\n/g, '<br/>');
                    
                    setRenderedContent(processed);
                    setError(null);
                } catch (e) {
                    setError(e.message);
                }
            }, [content]);
            
            if (error) {
                return <div className="error">MathRenderer é”™è¯¯: {error}</div>;
            }
            
            return <div dangerouslySetInnerHTML={{ __html: renderedContent }} />;
        };
        
        // æ¨¡æ‹Ÿ MarkdownRenderer ç»„ä»¶ï¼ˆç®€åŒ–ç‰ˆï¼‰
        const MarkdownRenderer = ({ content }) => {
            const [renderedContent, setRenderedContent] = useState('');
            const [error, setError] = useState(null);
            
            useEffect(() => {
                try {
                    // æ£€æŸ¥æ˜¯å¦æœ‰æ•°å­¦å…¬å¼
                    const hasMath = /\$.*?\$/.test(content);
                    
                    if (!hasMath) {
                        // æ²¡æœ‰æ•°å­¦å…¬å¼ï¼Œç›´æ¥ç”¨markdownæ¸²æŸ“
                        setRenderedContent(`<div>çº¯Markdownå†…å®¹ï¼ˆæ— æ•°å­¦å…¬å¼ï¼‰: ${content}</div>`);
                        return;
                    }
                    
                    // æœ‰æ•°å­¦å…¬å¼çš„å¤„ç†é€»è¾‘
                    let processed = content;
                    
                    // å…ˆå¤„ç†å—çº§å…¬å¼
                    const blockMatches = [];
                    processed = processed.replace(/\$\$([^$]+)\$\$/g, (match, formula, offset) => {
                        blockMatches.push({ start: offset, end: offset + match.length, formula: formula.trim() });
                        return `__BLOCK_MATH_${blockMatches.length - 1}__`;
                    });
                    
                    // å†å¤„ç†è¡Œå†…å…¬å¼
                    const inlineMatches = [];
                    processed = processed.replace(/\$([^$]+)\$/g, (match, formula, offset) => {
                        inlineMatches.push({ start: offset, end: offset + match.length, formula: formula.trim() });
                        return `__INLINE_MATH_${inlineMatches.length - 1}__`;
                    });
                    
                    // æ¸²æŸ“æ•°å­¦å…¬å¼
                    blockMatches.forEach((match, index) => {
                        try {
                            const rendered = katex.renderToString(match.formula, { displayMode: true });
                            processed = processed.replace(`__BLOCK_MATH_${index}__`, `<div class="katex-display">${rendered}</div>`);
                        } catch (e) {
                            processed = processed.replace(`__BLOCK_MATH_${index}__`, `<span class="error">$$${match.formula}$$</span>`);
                        }
                    });
                    
                    inlineMatches.forEach((match, index) => {
                        try {
                            const rendered = katex.renderToString(match.formula, { displayMode: false });
                            processed = processed.replace(`__INLINE_MATH_${index}__`, rendered);
                        } catch (e) {
                            processed = processed.replace(`__INLINE_MATH_${index}__`, `<span class="error">$${match.formula}$</span>`);
                        }
                    });
                    
                    // å¤„ç†markdownè¯­æ³•ï¼ˆç®€åŒ–ï¼‰
                    processed = processed
                        .replace(/^## (.+)$/gm, '<h2>$1</h2>')
                        .replace(/^# (.+)$/gm, '<h1>$1</h1>')
                        .replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>')
                        .replace(/^\d+\. (.+)$/gm, '<li>$1</li>')
                        .replace(/\n/g, '<br/>');
                    
                    setRenderedContent(processed);
                    setError(null);
                } catch (e) {
                    setError(e.message);
                }
            }, [content]);
            
            if (error) {
                return <div className="error">MarkdownRenderer é”™è¯¯: {error}</div>;
            }
            
            return <div dangerouslySetInnerHTML={{ __html: renderedContent }} />;
        };
        
        const TestApp = () => {
            const [selectedTest, setSelectedTest] = useState(1);
            
            const currentContent = selectedTest === 1 ? testContent1 : testContent2;
            
            return (
                <div>
                    <div style={{ marginBottom: '20px' }}>
                        <button 
                            onClick={() => setSelectedTest(1)}
                            style={{ 
                                marginRight: '10px', 
                                padding: '8px 16px',
                                backgroundColor: selectedTest === 1 ? '#007acc' : '#f0f0f0',
                                color: selectedTest === 1 ? 'white' : 'black',
                                border: 'none',
                                borderRadius: '4px',
                                cursor: 'pointer'
                            }}
                        >
                            æµ‹è¯•1: å¤æ‚å†…å®¹
                        </button>
                        <button 
                            onClick={() => setSelectedTest(2)}
                            style={{ 
                                padding: '8px 16px',
                                backgroundColor: selectedTest === 2 ? '#007acc' : '#f0f0f0',
                                color: selectedTest === 2 ? 'white' : 'black',
                                border: 'none',
                                borderRadius: '4px',
                                cursor: 'pointer'
                            }}
                        >
                            æµ‹è¯•2: ç®€å•å†…å®¹
                        </button>
                    </div>
                    
                    <div className="raw-content">
                        <strong>åŸå§‹å†…å®¹:</strong><br/>
                        {currentContent}
                    </div>
                    
                    <div className="test-container">
                        <div className="test-section">
                            <div className="test-title">ğŸ“ MarkdownRenderer æ¸²æŸ“ç»“æœ</div>
                            <div className="test-content">
                                <MarkdownRenderer content={currentContent} />
                            </div>
                            <div className="status success">âœ… MarkdownRenderer ç»„ä»¶å·²åŠ è½½</div>
                        </div>
                        
                        <div className="test-section">
                            <div className="test-title">ğŸ§® MathRenderer æ¸²æŸ“ç»“æœ</div>
                            <div className="test-content">
                                <MathRenderer content={currentContent} />
                            </div>
                            <div className="status success">âœ… MathRenderer ç»„ä»¶å·²åŠ è½½</div>
                        </div>
                    </div>
                    
                    <div className="test-section">
                        <div className="test-title">ğŸ” æ¸²æŸ“åˆ†æ</div>
                        <div className="test-content">
                            <p><strong>é¢„æœŸè¡Œä¸º:</strong></p>
                            <ul>
                                <li>MarkdownRenderer åº”è¯¥åŒæ—¶æ¸²æŸ“ Markdown è¯­æ³•å’Œæ•°å­¦å…¬å¼</li>
                                <li>MathRenderer åº”è¯¥åªæ¸²æŸ“æ•°å­¦å…¬å¼ï¼Œä¿ç•™å…¶ä»–æ–‡æœ¬</li>
                                <li>ä¸¤è€…çš„æ•°å­¦å…¬å¼æ¸²æŸ“æ•ˆæœåº”è¯¥ç›¸åŒ</li>
                            </ul>
                            
                            <p><strong>æ£€æŸ¥è¦ç‚¹:</strong></p>
                            <ul>
                                <li>æ•°å­¦å…¬å¼æ˜¯å¦æ­£ç¡®æ¸²æŸ“ä¸º KaTeX æ ¼å¼</li>
                                <li>Markdown è¯­æ³•ï¼ˆæ ‡é¢˜ã€ç²—ä½“ã€åˆ—è¡¨ï¼‰æ˜¯å¦æ­£ç¡®è½¬æ¢</li>
                                <li>æ˜¯å¦æœ‰ JavaScript é”™è¯¯ï¼ˆæ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°ï¼‰</li>
                            </ul>
                        </div>
                    </div>
                </div>
            );
        };
        
        ReactDOM.render(<TestApp />, document.getElementById('test-app'));
    </script>
</body>
</html>