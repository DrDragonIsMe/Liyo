<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çŸ¥è¯†ç‚¹LaTeXæ¸²æŸ“æµ‹è¯•</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/contrib/auto-render.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
            background: #f9fafb;
        }
        .knowledge-point-card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        .title {
            font-size: 24px;
            font-weight: bold;
            color: #1f2937;
            margin-bottom: 16px;
            border-bottom: 2px solid #3b82f6;
            padding-bottom: 8px;
        }
        .definition {
            color: #374151;
            line-height: 1.8;
        }
        .definition h2 {
            color: #1f2937;
            font-size: 18px;
            margin: 20px 0 12px 0;
        }
        .definition h3 {
            color: #374151;
            font-size: 16px;
            margin: 16px 0 8px 0;
        }
        .definition ol, .definition ul {
            margin: 12px 0;
            padding-left: 24px;
        }
        .definition li {
            margin: 8px 0;
        }
        .definition strong {
            color: #1f2937;
            font-weight: 600;
        }
        .related-concepts {
            margin-top: 20px;
            padding-top: 16px;
            border-top: 1px solid #e5e7eb;
        }
        .concept-tag {
            display: inline-block;
            background: #dbeafe;
            color: #1e40af;
            padding: 4px 12px;
            border-radius: 16px;
            font-size: 14px;
            margin: 4px 8px 4px 0;
        }
        .status {
            padding: 12px;
            border-radius: 8px;
            margin: 16px 0;
            font-weight: 500;
        }
        .status.success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #a7f3d0;
        }
        .status.error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fca5a5;
        }
        .loading {
            text-align: center;
            padding: 40px;
            color: #6b7280;
        }
        .test-info {
            background: #fef3c7;
            border: 1px solid #f59e0b;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 20px;
        }
        .test-info h3 {
            margin: 0 0 8px 0;
            color: #92400e;
        }
        .test-info p {
            margin: 0;
            color: #78350f;
        }
    </style>
</head>
<body>
    <div class="test-info">
        <h3>ğŸ§ª LaTeXå…¬å¼æ¸²æŸ“æµ‹è¯•</h3>
        <p>æ­¤é¡µé¢æµ‹è¯•MarkdownRendererç»„ä»¶å¤„ç†çŸ¥è¯†ç‚¹ä¸­LaTeXå…¬å¼çš„èƒ½åŠ›ã€‚å°†ä»APIè·å–é…æ–¹æ³•çŸ¥è¯†ç‚¹å¹¶æ¸²æŸ“å…¶å®šä¹‰ä¸­çš„æ•°å­¦å…¬å¼ã€‚</p>
    </div>

    <div class="knowledge-point-card">
        <div class="title">é…æ–¹æ³•</div>
        <div id="status" class="status">æ­£åœ¨åŠ è½½çŸ¥è¯†ç‚¹æ•°æ®...</div>
        <div id="definition" class="definition" style="display: none;"></div>
        <div id="related-concepts" class="related-concepts" style="display: none;">
            <h4>ç›¸å…³æ¦‚å¿µï¼š</h4>
            <div id="concepts-list"></div>
        </div>
    </div>

    <div class="knowledge-point-card">
        <div class="title">æ¸²æŸ“æµ‹è¯•å¯¹æ¯”</div>
        <div class="definition">
            <h3>åŸå§‹LaTeXä»£ç ï¼š</h3>
            <pre style="background: #f3f4f6; padding: 12px; border-radius: 6px; overflow-x: auto; font-size: 14px;">é…æ–¹æ³•æ˜¯å°†äºŒæ¬¡æ–¹ç¨‹ $ax^2 + bx + c = 0$ è½¬åŒ–ä¸º $(x + m)^2 = n$ çš„å½¢å¼çš„è§£æ³•ã€‚

## åŸºæœ¬æ­¥éª¤

1. **ç§»é¡¹**ï¼šå°†å¸¸æ•°é¡¹ç§»åˆ°ç­‰å·å³è¾¹
   $ax^2 + bx = -c$

2. **ç³»æ•°åŒ–1**ï¼šä¸¤è¾¹åŒæ—¶é™¤ä»¥ $a$
   $x^2 + \frac{b}{a}x = -\frac{c}{a}$

3. **é…æ–¹**ï¼šä¸¤è¾¹åŒæ—¶åŠ ä¸Šä¸€æ¬¡é¡¹ç³»æ•°ä¸€åŠçš„å¹³æ–¹
   $x^2 + \frac{b}{a}x + \left(\frac{b}{2a}\right)^2 = -\frac{c}{a} + \left(\frac{b}{2a}\right)^2$

4. **åŒ–ç®€**ï¼šå·¦è¾¹å†™æˆå®Œå…¨å¹³æ–¹å¼
   $$\left(x + \frac{b}{2a}\right)^2 = \frac{b^2 - 4ac}{4a^2}$$

## å…³é”®å…¬å¼

é…æ–¹åçš„æ ‡å‡†å½¢å¼ï¼š
$$\left(x + \frac{b}{2a}\right)^2 = \frac{\Delta}{4a^2}$$

å…¶ä¸­åˆ¤åˆ«å¼ $\Delta = b^2 - 4ac$</pre>
            
            <h3>æ¸²æŸ“æ•ˆæœï¼š</h3>
            <div id="manual-render" class="definition"></div>
        </div>
    </div>

    <script>
        // Unicodeæ•°å­¦ç¬¦å·è½¬LaTeXçš„æ˜ å°„ï¼ˆä¸MarkdownRendererä¿æŒä¸€è‡´ï¼‰
        function preprocessLatex(text) {
            return text
                // ç§¯åˆ†ç¬¦å·
                .replace(/âˆ«/g, '\\int')
                // ä¸Šæ ‡æ•°å­—
                .replace(/Â¹/g, '^1')
                .replace(/Â²/g, '^2')
                .replace(/Â³/g, '^3')
                .replace(/â´/g, '^4')
                .replace(/âµ/g, '^5')
                .replace(/â¶/g, '^6')
                .replace(/â·/g, '^7')
                .replace(/â¸/g, '^8')
                .replace(/â¹/g, '^9')
                .replace(/â°/g, '^0')
                // ä¸‹æ ‡æ•°å­—
                .replace(/â‚/g, '_1')
                .replace(/â‚‚/g, '_2')
                .replace(/â‚ƒ/g, '_3')
                .replace(/â‚„/g, '_4')
                .replace(/â‚…/g, '_5')
                .replace(/â‚†/g, '_6')
                .replace(/â‚‡/g, '_7')
                .replace(/â‚ˆ/g, '_8')
                .replace(/â‚‰/g, '_9')
                .replace(/â‚€/g, '_0')
                // åˆ†æ•°ç¬¦å·
                .replace(/Â½/g, '\\frac{1}{2}')
                .replace(/â…“/g, '\\frac{1}{3}')
                .replace(/Â¼/g, '\\frac{1}{4}')
                .replace(/Â¾/g, '\\frac{3}{4}')
                // æ±‚å’Œç¬¦å·
                .replace(/âˆ‘/g, '\\sum')
                // å¸Œè…Šå­—æ¯
                .replace(/Î±/g, '\\alpha')
                .replace(/Î²/g, '\\beta')
                .replace(/Î³/g, '\\gamma')
                .replace(/Î´/g, '\\delta')
                .replace(/Îµ/g, '\\epsilon')
                .replace(/Î¸/g, '\\theta')
                .replace(/Î»/g, '\\lambda')
                .replace(/Î¼/g, '\\mu')
                .replace(/Ï€/g, '\\pi')
                .replace(/Ïƒ/g, '\\sigma')
                .replace(/Ï†/g, '\\phi')
                .replace(/Ï‰/g, '\\omega')
                // å…¶ä»–æ•°å­¦ç¬¦å·
                .replace(/Â±/g, '\\pm')
                .replace(/âˆ/g, '\\infty')
                .replace(/âˆš/g, '\\sqrt')
                .replace(/â‰¤/g, '\\leq')
                .replace(/â‰¥/g, '\\geq')
                .replace(/â‰ /g, '\\neq')
                .replace(/â‰ˆ/g, '\\approx')
                .replace(/âˆ†/g, '\\Delta');
        }

        // æ¨¡æ‹ŸMarkdownRendererçš„é¢„å¤„ç†é€»è¾‘
        function preprocessContent(text) {
            const mathPlaceholders = {};
            let placeholderIndex = 0;
            
            // å¤„ç†å—çº§å…¬å¼ $$...$$
            text = text.replace(/\$\$([^$]+)\$\$/g, (match, formula) => {
                const placeholder = `__BLOCK_MATH_${placeholderIndex++}__`;
                mathPlaceholders[placeholder] = preprocessLatex(formula.trim());
                return placeholder;
            });
            
            // å¤„ç†è¡Œå†…å…¬å¼ $...$
            text = text.replace(/\$([^$]+)\$/g, (match, formula) => {
                const placeholder = `__INLINE_MATH_${placeholderIndex++}__`;
                mathPlaceholders[placeholder] = preprocessLatex(formula.trim());
                return placeholder;
            });
            
            return { text, mathPlaceholders };
        }

        // æ¸²æŸ“Markdownå†…å®¹
        function renderMarkdown(content) {
            const { text, mathPlaceholders } = preprocessContent(content);
            
            // ç®€å•çš„Markdownæ¸²æŸ“ï¼ˆæ ‡é¢˜ã€åˆ—è¡¨ã€ç²—ä½“ï¼‰
            let html = text
                .replace(/^## (.+)$/gm, '<h2>$1</h2>')
                .replace(/^### (.+)$/gm, '<h3>$1</h3>')
                .replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>')
                .replace(/^(\d+\.)\s+(.+)$/gm, '<li>$2</li>')
                .replace(/\n/g, '<br>');
            
            // åŒ…è£…åˆ—è¡¨é¡¹
            html = html.replace(/((<li>.*?<\/li>)+)/g, '<ol>$1</ol>');
            
            // æ›¿æ¢æ•°å­¦å…¬å¼å ä½ç¬¦
            Object.keys(mathPlaceholders).forEach(placeholder => {
                const formula = mathPlaceholders[placeholder];
                if (placeholder.includes('BLOCK_MATH')) {
                    html = html.replace(placeholder, `$$${formula}$$`);
                } else {
                    html = html.replace(placeholder, `$${formula}$`);
                }
            });
            
            return html;
        }

        // è·å–çŸ¥è¯†ç‚¹æ•°æ®
        async function fetchKnowledgePoint() {
            const statusEl = document.getElementById('status');
            const definitionEl = document.getElementById('definition');
            const conceptsEl = document.getElementById('related-concepts');
            const conceptsListEl = document.getElementById('concepts-list');
            
            try {
                statusEl.textContent = 'æ­£åœ¨ä»APIè·å–æ•°æ®...';
                statusEl.className = 'status';
                
                const response = await fetch('http://localhost:5001/api/knowledge-points/é…æ–¹æ³•?subject=æ•°å­¦');
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                
                if (!data.success) {
                    throw new Error(data.error || 'APIè¿”å›å¤±è´¥çŠ¶æ€');
                }
                
                const knowledgeData = data.data;
                
                // æ˜¾ç¤ºæˆåŠŸçŠ¶æ€
                statusEl.textContent = `âœ… æˆåŠŸè·å–çŸ¥è¯†ç‚¹æ•°æ® (æ¥æº: ${knowledgeData.source})`;
                statusEl.className = 'status success';
                
                // æ¸²æŸ“å®šä¹‰
                const renderedDefinition = renderMarkdown(knowledgeData.definition);
                definitionEl.innerHTML = renderedDefinition;
                definitionEl.style.display = 'block';
                
                // æ¸²æŸ“ç›¸å…³æ¦‚å¿µ
                if (knowledgeData.relatedConcepts && knowledgeData.relatedConcepts.length > 0) {
                    conceptsListEl.innerHTML = knowledgeData.relatedConcepts
                        .map(concept => `<span class="concept-tag">${concept}</span>`)
                        .join('');
                    conceptsEl.style.display = 'block';
                }
                
                // æ¸²æŸ“æ‰‹åŠ¨æµ‹è¯•å†…å®¹
                const manualContent = `é…æ–¹æ³•æ˜¯å°†äºŒæ¬¡æ–¹ç¨‹ $ax^2 + bx + c = 0$ è½¬åŒ–ä¸º $(x + m)^2 = n$ çš„å½¢å¼çš„è§£æ³•ã€‚

## åŸºæœ¬æ­¥éª¤

1. **ç§»é¡¹**ï¼šå°†å¸¸æ•°é¡¹ç§»åˆ°ç­‰å·å³è¾¹
   $ax^2 + bx = -c$

2. **ç³»æ•°åŒ–1**ï¼šä¸¤è¾¹åŒæ—¶é™¤ä»¥ $a$
   $x^2 + \\frac{b}{a}x = -\\frac{c}{a}$

3. **é…æ–¹**ï¼šä¸¤è¾¹åŒæ—¶åŠ ä¸Šä¸€æ¬¡é¡¹ç³»æ•°ä¸€åŠçš„å¹³æ–¹
   $x^2 + \\frac{b}{a}x + \\left(\\frac{b}{2a}\\right)^2 = -\\frac{c}{a} + \\left(\\frac{b}{2a}\\right)^2$

4. **åŒ–ç®€**ï¼šå·¦è¾¹å†™æˆå®Œå…¨å¹³æ–¹å¼
   $$\\left(x + \\frac{b}{2a}\\right)^2 = \\frac{b^2 - 4ac}{4a^2}$$

## å…³é”®å…¬å¼

é…æ–¹åçš„æ ‡å‡†å½¢å¼ï¼š
$$\\left(x + \\frac{b}{2a}\\right)^2 = \\frac{\\Delta}{4a^2}$$

å…¶ä¸­åˆ¤åˆ«å¼ $\\Delta = b^2 - 4ac$`;
                
                document.getElementById('manual-render').innerHTML = renderMarkdown(manualContent);
                
                // æ¸²æŸ“æ‰€æœ‰æ•°å­¦å…¬å¼
                setTimeout(() => {
                    renderMathInElement(document.body, {
                        delimiters: [
                            {left: '$$', right: '$$', display: true},
                            {left: '$', right: '$', display: false}
                        ],
                        throwOnError: false,
                        errorCallback: function(msg, err) {
                            console.error('KaTeXæ¸²æŸ“é”™è¯¯:', msg, err);
                        }
                    });
                }, 100);
                
            } catch (error) {
                console.error('è·å–çŸ¥è¯†ç‚¹å¤±è´¥:', error);
                statusEl.textContent = `âŒ è·å–çŸ¥è¯†ç‚¹å¤±è´¥: ${error.message}`;
                statusEl.className = 'status error';
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆåè·å–æ•°æ®
        document.addEventListener('DOMContentLoaded', fetchKnowledgePoint);
    </script>
</body>
</html>