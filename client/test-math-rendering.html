<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•°å­¦å…¬å¼æ¸²æŸ“æµ‹è¯•</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/contrib/auto-render.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .test-section {
            margin: 30px 0;
            padding: 20px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            background: #f9fafb;
        }
        .test-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #374151;
        }
        .formula-test {
            margin: 15px 0;
            padding: 15px;
            background: white;
            border-radius: 6px;
            border-left: 4px solid #3b82f6;
        }
        .formula-label {
            font-weight: 600;
            color: #6b7280;
            margin-bottom: 8px;
        }
        .formula-content {
            font-family: 'Times New Roman', serif;
            font-size: 16px;
            line-height: 1.8;
        }
        .error {
            color: #dc2626;
            background: #fef2f2;
            padding: 8px;
            border-radius: 4px;
            border-left: 4px solid #dc2626;
        }
        .success {
            color: #059669;
            background: #f0fdf4;
            padding: 8px;
            border-radius: 4px;
            border-left: 4px solid #059669;
        }
        .raw-text {
            background: #f3f4f6;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 14px;
            margin-top: 10px;
        }
        .test-button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 10px 5px;
        }
        .test-button:hover {
            background: #2563eb;
        }
    </style>
</head>
<body>
    <h1>æ•°å­¦å…¬å¼æ¸²æŸ“æµ‹è¯• - Azure GPT-4 LaTeX è¯­æ³•é€‚é…</h1>
    
    <div class="test-section">
        <div class="test-title">1. å¸¸è§çš„Azure GPT-4ç”Ÿæˆçš„LaTeXå…¬å¼æ ¼å¼</div>
        
        <div class="formula-test">
            <div class="formula-label">è¡Œå†…å…¬å¼ - åŸºæœ¬æ ¼å¼:</div>
            <div class="formula-content" id="inline-basic">è¿™æ˜¯ä¸€ä¸ªè¡Œå†…å…¬å¼ $x^2 + y^2 = z^2$ï¼Œåº”è¯¥æ­£å¸¸æ˜¾ç¤ºã€‚</div>
            <div class="raw-text">åŸå§‹æ–‡æœ¬: è¿™æ˜¯ä¸€ä¸ªè¡Œå†…å…¬å¼ $x^2 + y^2 = z^2$ï¼Œåº”è¯¥æ­£å¸¸æ˜¾ç¤ºã€‚</div>
        </div>
        
        <div class="formula-test">
            <div class="formula-label">å—çº§å…¬å¼ - åŸºæœ¬æ ¼å¼:</div>
            <div class="formula-content" id="block-basic">
                æ±‚è§£äºŒæ¬¡æ–¹ç¨‹çš„å…¬å¼ï¼š
                $$x = \frac{-b \pm \sqrt{b^2 - 4ac}}{2a}$$
            </div>
            <div class="raw-text">åŸå§‹æ–‡æœ¬: $$x = \frac{-b \pm \sqrt{b^2 - 4ac}}{2a}$$</div>
        </div>
        
        <div class="formula-test">
            <div class="formula-label">Azure GPT-4å¸¸è§çš„å¤æ‚å…¬å¼:</div>
            <div class="formula-content" id="complex-formula">
                ç§¯åˆ†å…¬å¼ï¼š$$\int_{-\infty}^{\infty} e^{-x^2} dx = \sqrt{\pi}$$
                
                çŸ©é˜µè¡¨ç¤ºï¼š$$\begin{pmatrix} a & b \\ c & d \end{pmatrix}$$
                
                æ±‚å’Œå…¬å¼ï¼š$$\sum_{n=1}^{\infty} \frac{1}{n^2} = \frac{\pi^2}{6}$$
            </div>
        </div>
    </div>
    
    <div class="test-section">
        <div class="test-title">2. å¯èƒ½çš„é—®é¢˜æ ¼å¼æµ‹è¯•</div>
        
        <div class="formula-test">
            <div class="formula-label">è½¬ä¹‰å­—ç¬¦é—®é¢˜:</div>
            <div class="formula-content" id="escape-test">
                å¯èƒ½çš„è½¬ä¹‰é—®é¢˜ï¼š$\\frac{1}{2}$ æˆ– $\frac{1}{2}$
            </div>
        </div>
        
        <div class="formula-test">
            <div class="formula-label">å¤šè¡Œå…¬å¼:</div>
            <div class="formula-content" id="multiline-test">
                $$\begin{align}
                f(x) &= ax^2 + bx + c \\
                f'(x) &= 2ax + b \\
                f''(x) &= 2a
                \end{align}$$
            </div>
        </div>
        
        <div class="formula-test">
            <div class="formula-label">æ··åˆæ–‡æœ¬å’Œå…¬å¼:</div>
            <div class="formula-content" id="mixed-test">
                å½“ $a > 0$ æ—¶ï¼Œå‡½æ•° $f(x) = ax^2 + bx + c$ çš„æœ€å°å€¼ä¸º $f\left(-\frac{b}{2a}\right) = c - \frac{b^2}{4a}$ã€‚
            </div>
        </div>
    </div>
    
    <div class="test-section">
        <div class="test-title">3. å®æ—¶æµ‹è¯•Azure GPT-4ç”Ÿæˆçš„ç­”é¢˜æ–¹æ¡ˆ</div>
        
        <button class="test-button" onclick="testRealTimeSolutions()">æµ‹è¯•å®æ—¶ç­”é¢˜æ–¹æ¡ˆAPI</button>
        <button class="test-button" onclick="testMathFormulas()">æµ‹è¯•æ•°å­¦å…¬å¼æ¸²æŸ“</button>
        
        <div id="api-test-result" style="margin-top: 20px;"></div>
    </div>
    
    <div class="test-section">
        <div class="test-title">4. æ¸²æŸ“çŠ¶æ€æ£€æŸ¥</div>
        <div id="render-status"></div>
    </div>

    <script>
        // åˆå§‹åŒ–KaTeXæ¸²æŸ“
        document.addEventListener("DOMContentLoaded", function() {
            renderMathInElement(document.body, {
                delimiters: [
                    {left: "$$", right: "$$", display: true},
                    {left: "$", right: "$", display: false}
                ],
                throwOnError: false,
                errorColor: '#cc0000',
                strict: false
            });
            
            checkRenderStatus();
        });
        
        function checkRenderStatus() {
            const statusDiv = document.getElementById('render-status');
            const mathElements = document.querySelectorAll('.katex, .katex-display');
            const errorElements = document.querySelectorAll('.katex-error');
            
            let status = `<div class="success">âœ… KaTeXå·²åŠ è½½ï¼Œæ‰¾åˆ° ${mathElements.length} ä¸ªæ¸²æŸ“çš„å…¬å¼</div>`;
            
            if (errorElements.length > 0) {
                status += `<div class="error">âŒ å‘ç° ${errorElements.length} ä¸ªæ¸²æŸ“é”™è¯¯</div>`;
                errorElements.forEach((el, i) => {
                    status += `<div class="raw-text">é”™è¯¯ ${i+1}: ${el.textContent}</div>`;
                });
            }
            
            statusDiv.innerHTML = status;
        }
        
        async function testRealTimeSolutions() {
            const resultDiv = document.getElementById('api-test-result');
            resultDiv.innerHTML = '<div>ğŸ”„ æ­£åœ¨æµ‹è¯•å®æ—¶ç­”é¢˜æ–¹æ¡ˆAPI...</div>';
            
            try {
                const response = await fetch('/api/ai/solutions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        question: 'æ±‚è§£æ–¹ç¨‹ xÂ² + 2x - 3 = 0',
                        subject: 'æ•°å­¦',
                        difficulty: 'medium'
                    })
                });
                
                const data = await response.json();
                
                if (data.success && data.solutions) {
                    let html = '<div class="success">âœ… APIè°ƒç”¨æˆåŠŸï¼Œç”Ÿæˆäº†ç­”é¢˜æ–¹æ¡ˆ</div>';
                    
                    data.solutions.forEach((solution, index) => {
                        html += `
                            <div class="formula-test">
                                <div class="formula-label">æ–¹æ¡ˆ ${index + 1}: ${solution.title || 'è§£é¢˜æ–¹æ¡ˆ'}</div>
                                <div class="formula-content solution-content">
                                    <strong>è§£é¢˜æ€è·¯:</strong> ${solution.approach || ''}<br>
                                    <strong>æ­¥éª¤:</strong> ${(solution.steps || []).join('<br>')}<br>
                                    <strong>å…³é”®è¦ç‚¹:</strong> ${(solution.keyPoints || []).join('<br>')}
                                </div>
                                <div class="raw-text">åŸå§‹JSON: ${JSON.stringify(solution, null, 2)}</div>
                            </div>
                        `;
                    });
                    
                    resultDiv.innerHTML = html;
                    
                    // é‡æ–°æ¸²æŸ“æ•°å­¦å…¬å¼
                    setTimeout(() => {
                        renderMathInElement(resultDiv, {
                            delimiters: [
                                {left: "$$", right: "$$", display: true},
                                {left: "$", right: "$", display: false}
                            ],
                            throwOnError: false,
                            errorColor: '#cc0000'
                        });
                        checkRenderStatus();
                    }, 100);
                } else {
                    resultDiv.innerHTML = `<div class="error">âŒ APIè¿”å›é”™è¯¯: ${data.error || 'æœªçŸ¥é”™è¯¯'}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">âŒ è¯·æ±‚å¤±è´¥: ${error.message}</div>`;
            }
        }
        
        function testMathFormulas() {
            const testFormulas = [
                'x^2 + y^2 = z^2',
                '\\frac{-b \\pm \\sqrt{b^2 - 4ac}}{2a}',
                '\\int_{0}^{1} x^2 dx = \\frac{1}{3}',
                '\\sum_{n=1}^{\\infty} \\frac{1}{n^2} = \\frac{\\pi^2}{6}'
            ];
            
            const resultDiv = document.getElementById('api-test-result');
            let html = '<div class="test-title">æ•°å­¦å…¬å¼æ¸²æŸ“æµ‹è¯•ç»“æœ:</div>';
            
            testFormulas.forEach((formula, index) => {
                html += `
                    <div class="formula-test">
                        <div class="formula-label">æµ‹è¯•å…¬å¼ ${index + 1}:</div>
                        <div class="formula-content">$${formula}$</div>
                        <div class="raw-text">LaTeX: ${formula}</div>
                    </div>
                `;
            });
            
            resultDiv.innerHTML = html;
            
            // é‡æ–°æ¸²æŸ“æ•°å­¦å…¬å¼
            setTimeout(() => {
                renderMathInElement(resultDiv, {
                    delimiters: [
                        {left: "$$", right: "$$", display: true},
                        {left: "$", right: "$", display: false}
                    ],
                    throwOnError: false,
                    errorColor: '#cc0000'
                });
                checkRenderStatus();
            }, 100);
        }
    </script>
</body>
</html>