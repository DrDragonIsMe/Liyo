<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LaTeXæ¸²æŸ“é—®é¢˜æµ‹è¯•</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/contrib/auto-render.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .test-section {
            margin: 30px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #f9f9f9;
        }
        .test-title {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
            border-bottom: 2px solid #007acc;
            padding-bottom: 5px;
        }
        .original-content {
            background: #fff;
            padding: 15px;
            border-radius: 6px;
            border-left: 4px solid #ffa500;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            white-space: pre-wrap;
        }
        .rendered-content {
            background: #fff;
            padding: 15px;
            border-radius: 6px;
            border-left: 4px solid #28a745;
            margin: 10px 0;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 4px 8px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }
        .status {
            padding: 10px;
            border-radius: 6px;
            margin: 10px 0;
            font-weight: bold;
        }
        .loading { background: #d1ecf1; color: #0c5460; }
        .success { background: #d4edda; color: #155724; }
        .error-status { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <h1>ğŸ” LaTeXæ¸²æŸ“é—®é¢˜è¯Šæ–­</h1>
    <p>æµ‹è¯•çŸ¥è¯†ç‚¹ä¸­LaTeXå…¬å¼çš„æ¸²æŸ“æƒ…å†µï¼Œæ£€æŸ¥æ˜¯å¦å­˜åœ¨"æœ‰äº›æ˜¯å…¬å¼ï¼Œæœ‰äº›è¿˜æ˜¯åŸæ¥çš„è¯­æ³•"çš„é—®é¢˜ã€‚</p>
    
    <div id="status" class="status loading">æ­£åœ¨è·å–çŸ¥è¯†ç‚¹æ•°æ®...</div>
    
    <div class="test-section">
        <div class="test-title">1. é…æ–¹æ³•çŸ¥è¯†ç‚¹ - åŸå§‹æ•°æ®</div>
        <div class="original-content" id="original-content">åŠ è½½ä¸­...</div>
    </div>
    
    <div class="test-section">
        <div class="test-title">2. æ¨¡æ‹ŸMarkdownRendererå¤„ç†åçš„å†…å®¹</div>
        <div class="rendered-content" id="processed-content">å¤„ç†ä¸­...</div>
    </div>
    
    <div class="test-section">
        <div class="test-title">3. KaTeXæœ€ç»ˆæ¸²æŸ“æ•ˆæœ</div>
        <div class="rendered-content" id="final-render">æ¸²æŸ“ä¸­...</div>
    </div>
    
    <div class="test-section">
        <div class="test-title">4. é—®é¢˜è¯Šæ–­ç»“æœ</div>
        <div id="diagnosis" class="rendered-content">åˆ†æä¸­...</div>
    </div>

    <script>
        // æ¨¡æ‹ŸMarkdownRendererçš„é¢„å¤„ç†å‡½æ•°
        function preprocessLatex(text) {
            return text
                // æ¸…ç†ä¸­æ–‡æ ‡ç‚¹ç¬¦å·
                .replace(/ï¼Œ/g, ',')
                .replace(/ã€‚/g, '.')
                .replace(/ï¼›/g, ';')
                .replace(/ï¼š/g, ':')
                .replace(/ï¼Ÿ/g, '?')
                .replace(/ï¼/g, '!')
                .replace(/ï¼ˆ/g, '(')
                .replace(/ï¼‰/g, ')')
                .replace(/ã€/g, '[')
                .replace(/ã€‘/g, ']')
                .replace(/ã€Œ/g, '"')
                .replace(/ã€/g, '"')
                .replace(/ã€/g, '"')
                .replace(/ã€/g, '"')
                // å¤„ç†åŒåæ–œæ è½¬ä¹‰é—®é¢˜
                .replace(/\\\\frac/g, '\\frac')
                .replace(/\\\\sqrt/g, '\\sqrt')
                .replace(/\\\\pm/g, '\\pm')
                .replace(/\\\\times/g, '\\times')
                .replace(/\\\\div/g, '\\div')
                .replace(/\\\\cdot/g, '\\cdot')
                .replace(/\\\\sum/g, '\\sum')
                .replace(/\\\\int/g, '\\int')
                .replace(/\\\\lim/g, '\\lim')
                .replace(/\\\\sin/g, '\\sin')
                .replace(/\\\\cos/g, '\\cos')
                .replace(/\\\\tan/g, '\\tan')
                .replace(/\\\\log/g, '\\log')
                .replace(/\\\\ln/g, '\\ln')
                .replace(/\\\\alpha/g, '\\alpha')
                .replace(/\\\\beta/g, '\\beta')
                .replace(/\\\\gamma/g, '\\gamma')
                .replace(/\\\\delta/g, '\\delta')
                .replace(/\\\\pi/g, '\\pi')
                .replace(/\\\\theta/g, '\\theta')
                .replace(/\\\\infty/g, '\\infty')
                .replace(/\\\\leq/g, '\\leq')
                .replace(/\\\\geq/g, '\\geq')
                .replace(/\\\\neq/g, '\\neq')
                .replace(/\\\\approx/g, '\\approx')
                .replace(/\\\\equiv/g, '\\equiv')
                .replace(/\\\\begin/g, '\\begin')
                .replace(/\\\\end/g, '\\end')
                .replace(/\\\\left/g, '\\left')
                .replace(/\\\\right/g, '\\right')
                // å¤„ç†å¸¸è§çš„Unicodeæ•°å­¦ç¬¦å·
                .replace(/Ã—/g, '\\times')
                .replace(/Ã·/g, '\\div')
                .replace(/Â±/g, '\\pm')
                .replace(/â‰¤/g, '\\leq')
                .replace(/â‰¥/g, '\\geq')
                .replace(/â‰ /g, '\\neq')
                .replace(/â‰ˆ/g, '\\approx')
                .replace(/âˆ/g, '\\infty')
                .replace(/Ï€/g, '\\pi')
                .replace(/Î±/g, '\\alpha')
                .replace(/Î²/g, '\\beta')
                .replace(/Î³/g, '\\gamma')
                .replace(/Î´/g, '\\delta')
                .replace(/Î¸/g, '\\theta')
                // å¤„ç†ä¸Šä¸‹æ ‡çš„Unicodeå­—ç¬¦
                .replace(/Â²/g, '^2')
                .replace(/Â³/g, '^3')
                .replace(/Â¹/g, '^1')
                .replace(/â‚/g, '_1')
                .replace(/â‚‚/g, '_2')
                .replace(/â‚ƒ/g, '_3');
        }
        
        function cleanMathContent(mathContent) {
            return mathContent
                // ç§»é™¤ä¸­æ–‡æ ‡ç‚¹ç¬¦å·
                .replace(/[ï¼Œã€‚ï¼›ï¼šï¼Ÿï¼ï¼ˆï¼‰ã€ã€‘ã€Œã€ã€ã€]/g, '')
                // ç§»é™¤ä¸­æ–‡å­—ç¬¦
                .replace(/[\u4e00-\u9fff]/g, '')
                // æ¸…ç†å¤šä½™ç©ºæ ¼
                .replace(/\s+/g, ' ')
                .trim();
        }
        
        async function testLatexRendering() {
            try {
                // ä½¿ç”¨é…æ–¹æ³•çŸ¥è¯†ç‚¹çš„å®é™…æ•°æ®
                const originalContent = `é…æ–¹æ³•æ˜¯è§£ä¸€å…ƒäºŒæ¬¡æ–¹ç¨‹çš„ä¸€ç§é‡è¦æ–¹æ³•ã€‚å¯¹äºä¸€èˆ¬å½¢å¼çš„ä¸€å…ƒäºŒæ¬¡æ–¹ç¨‹ $ax^2 + bx + c = 0$ (å…¶ä¸­ $a \\neq 0$)ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡é…æ–¹å°†å…¶è½¬åŒ–ä¸º $(x + m)^2 = n$ çš„å½¢å¼ã€‚\n\nå…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š\n\n1. **ç§»é¡¹**ï¼šå°†å¸¸æ•°é¡¹ç§»åˆ°ç­‰å·å³è¾¹\n   $ax^2 + bx = -c$\n\n2. **ç³»æ•°åŒ–1**ï¼šå°†äºŒæ¬¡é¡¹ç³»æ•°åŒ–ä¸º1\n   $x^2 + \\frac{b}{a}x = -\\frac{c}{a}$\n\n3. **é…æ–¹**ï¼šåœ¨ç­‰å¼ä¸¤è¾¹åŒæ—¶åŠ ä¸Šä¸€æ¬¡é¡¹ç³»æ•°ä¸€åŠçš„å¹³æ–¹\n   $x^2 + \\frac{b}{a}x + \\left(\\frac{b}{2a}\\right)^2 = -\\frac{c}{a} + \\left(\\frac{b}{2a}\\right)^2$\n\n4. **åŒ–ç®€**ï¼šå·¦è¾¹é…æˆå®Œå…¨å¹³æ–¹å¼\n   $$\\left(x + \\frac{b}{2a}\\right)^2 = \\frac{b^2 - 4ac}{4a^2}$$\n\n5. **å¼€æ–¹æ±‚è§£**ï¼š\n   - å½“åˆ¤åˆ«å¼ $\\Delta = b^2 - 4ac > 0$ æ—¶ï¼Œæ–¹ç¨‹æœ‰ä¸¤ä¸ªä¸ç›¸ç­‰çš„å®æ•°æ ¹\n   - å½“åˆ¤åˆ«å¼ $\\Delta = b^2 - 4ac = 0$ æ—¶ï¼Œæ–¹ç¨‹æœ‰ä¸¤ä¸ªç›¸ç­‰çš„å®æ•°æ ¹\n   - å½“åˆ¤åˆ«å¼ $\\Delta = b^2 - 4ac < 0$ æ—¶ï¼Œæ–¹ç¨‹æ— å®æ•°æ ¹\n\n**ç¤ºä¾‹**ï¼šè§£æ–¹ç¨‹ $x^2 + 4x + 1 = 0$\n\nè§£ï¼š$x^2 + 4x = -1$\n\né…æ–¹ï¼š$x^2 + 4x + 4 = -1 + 4$\n\nå³ï¼š$(x + 2)^2 = 3$\n\nå¼€æ–¹ï¼š$x + 2 = \\pm\\sqrt{3}$\n\næ‰€ä»¥ï¼š$x = -2 \\pm \\sqrt{3}$`;
                document.getElementById('original-content').textContent = originalContent;
                
                // æ¨¡æ‹ŸMarkdownRendererçš„å¤„ç†è¿‡ç¨‹
                const processedContent = preprocessLatex(originalContent);
                document.getElementById('processed-content').innerHTML = processedContent.replace(/\n/g, '<br>');
                
                // æœ€ç»ˆæ¸²æŸ“
                document.getElementById('final-render').innerHTML = processedContent.replace(/\n/g, '<br>');
                
                // è¯Šæ–­åˆ†æ
                const diagnosis = [];
                
                // æ£€æŸ¥LaTeXå…¬å¼
                const inlineMathMatches = originalContent.match(/\$[^$]+\$/g) || [];
                const blockMathMatches = originalContent.match(/\$\$[^$]+\$\$/g) || [];
                const unicodeSymbols = originalContent.match(/[Â²Â³Â¹â‚â‚‚â‚ƒÃ—Ã·Â±â‰¤â‰¥â‰ â‰ˆâˆÏ€]/g) || [];
                const doubleBackslashes = originalContent.match(/\\\\/g) || [];
                
                diagnosis.push(`<h4>LaTeXå…¬å¼åˆ†æï¼š</h4>`);
                diagnosis.push(`<ul>`);
                diagnosis.push(`<li>è¡Œå†…å…¬å¼æ•°é‡: ${inlineMathMatches.length}</li>`);
                diagnosis.push(`<li>å—çº§å…¬å¼æ•°é‡: ${blockMathMatches.length}</li>`);
                diagnosis.push(`<li>Unicodeç¬¦å·æ•°é‡: ${unicodeSymbols.length}</li>`);
                diagnosis.push(`<li>åŒåæ–œæ é—®é¢˜: ${doubleBackslashes.length}</li>`);
                diagnosis.push(`</ul>`);
                
                if (inlineMathMatches.length > 0) {
                    diagnosis.push(`<h4>è¡Œå†…å…¬å¼ï¼š</h4>`);
                    diagnosis.push(`<ul>`);
                    inlineMathMatches.forEach((match, i) => {
                        diagnosis.push(`<li><code>${match}</code></li>`);
                    });
                    diagnosis.push(`</ul>`);
                }
                
                if (blockMathMatches.length > 0) {
                    diagnosis.push(`<h4>å—çº§å…¬å¼ï¼š</h4>`);
                    diagnosis.push(`<ul>`);
                    blockMathMatches.forEach((match, i) => {
                        diagnosis.push(`<li><code>${match}</code></li>`);
                    });
                    diagnosis.push(`</ul>`);
                }
                
                if (unicodeSymbols.length > 0) {
                    diagnosis.push(`<h4>Unicodeç¬¦å·ï¼š</h4>`);
                    diagnosis.push(`<p><code>${unicodeSymbols.join(', ')}</code></p>`);
                }
                
                document.getElementById('diagnosis').innerHTML = diagnosis.join('');
                
                // æ¸²æŸ“æ•°å­¦å…¬å¼
                setTimeout(() => {
                    renderMathInElement(document.body, {
                        delimiters: [
                            {left: '$$', right: '$$', display: true},
                            {left: '$', right: '$', display: false}
                        ],
                        throwOnError: false,
                        errorCallback: function(msg, err) {
                            console.error('KaTeXæ¸²æŸ“é”™è¯¯:', msg, err);
                            diagnosis.push(`<div class="error">KaTeXé”™è¯¯: ${msg}</div>`);
                            document.getElementById('diagnosis').innerHTML = diagnosis.join('');
                        }
                    });
                    
                    document.getElementById('status').textContent = 'âœ… æµ‹è¯•å®Œæˆ';
                    document.getElementById('status').className = 'status success';
                }, 100);
                
            } catch (error) {
                console.error('æµ‹è¯•å¤±è´¥:', error);
                document.getElementById('status').textContent = `âŒ æµ‹è¯•å¤±è´¥: ${error.message}`;
                document.getElementById('status').className = 'status error-status';
                
                document.getElementById('original-content').textContent = 'è·å–æ•°æ®å¤±è´¥';
                document.getElementById('processed-content').textContent = 'å¤„ç†å¤±è´¥';
                document.getElementById('final-render').textContent = 'æ¸²æŸ“å¤±è´¥';
                document.getElementById('diagnosis').innerHTML = `<div class="error">é”™è¯¯: ${error.message}</div>`;
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåå¼€å§‹æµ‹è¯•
        document.addEventListener('DOMContentLoaded', testLatexRendering);
    </script>
</body>
</html>